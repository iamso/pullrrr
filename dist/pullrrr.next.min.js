/*!
 * pullrrr - version 0.3.0
 *
 * Made with ‚ù§ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2018 Steve Ottoz
 */
const body=document.body,html=document.documentElement,head=document.head,defaults={threshold:100,max:150,prefix:'pullrrr',over:!1,fade:!1,maxWidth:!1,top:!0,bottom:!0},eventOptions={passive:!1};let supportsPassive=!1;try{window.addEventListener('test',null,{get passive(){supportsPassive=!0}})}catch(a){}export default class Pullrrr{constructor(a={}){this.options=Object.assign({},defaults,a),this.dragging=!1,this.startY=null,this.distance=null,this.abs=null,this.direction=null,this.executed=!1,this.callbacks={},this.classContainer=`${this.options.prefix}-container`,this.classPullTop=`${this.options.prefix}-pull-top`,this.classPullBottom=`${this.options.prefix}-pull-bottom`,this.classUseOver=`${this.options.prefix}-use-over`,this.classOver=`${this.options.prefix}-over`,this.classPulledDown=`${this.options.prefix}-pulled-down`,this.classPulledUp=`${this.options.prefix}-pulled-up`,this.classPullingDown=`${this.options.prefix}-pulling-down`,this.classPullingUp=`${this.options.prefix}-pulling-up`,this.classThreshold=`${this.options.prefix}-threshold`,this.classIsTop=`${this.options.prefix}-is-top`,this.classIsBottom=`${this.options.prefix}-is-bottom`,this.styles=`
    /**
    * Required Pullrrr Styles
    */
    .${this.options.prefix}-container {
      transition: 0.2s ease-out;
    }
    ${this.options.top?`
    html.${this.options.prefix}-pulling-down .${this.options.prefix}-container,
    html.${this.options.prefix}-is-top .${this.options.prefix}-container {
      touch-action: pan-x pan-down pinch-zoom;
    }
    `:''}
    ${this.options.bottom?`
    html.${this.options.prefix}-pulling-up .${this.options.prefix}-container,
    html.${this.options.prefix}-is-bottom .${this.options.prefix}-container {
      touch-action: pan-x pan-up pinch-zoom;
    }
    `:''}
    html.${this.options.prefix}-pulling-up .${this.options.prefix}-container,
    html.${this.options.prefix}-pulling-down .${this.options.prefix}-container {
      transition: 0s;
    }`,this.init()}init(){return(this.options.top||this.options.bottom)&&(this.style=document.createElement('style'),this.style.id=`${this.options.prefix}-styles`,this.style.textContent=this.options.maxWidth&&!isNaN(this.options.maxWidth)?`
        @media (max-width: ${this.options.maxWidth}px) {
          ${this.styles}
        }
        `:this.styles,head.appendChild(this.style),this.container=this.options.container instanceof Node?this.options.container:'string'==typeof this.options.container?document.querySelector(this.options.container):body,this.container.classList.add(this.classContainer),this.options.top&&(this.options.pullTop instanceof Node?this.pullTop=this.options.pullTop:'string'==typeof this.options.pullTop?this.pullTop=document.querySelector(this.options.pullTop):(this.pullTop=document.querySelector(`.${this.classPullTop}`),!this.pullTop&&(this.pullTop=document.createElement('div'),this.pullTop.classList.add(this.classPullTop),this.container.appendChild(this.pullTop)))),this.options.bottom&&(this.options.pullBottom instanceof Node?this.pullBottom=this.options.pullBottom:'string'==typeof this.options.pullBottom?this.pullBottom=document.querySelector(this.options.pullBottom):(this.pullBottom=document.querySelector(`.${this.classPullBottom}`),!this.pullBottom&&(this.pullBottom=document.createElement('div'),this.pullBottom.classList.add(this.classPullBottom),this.container.appendChild(this.pullBottom)))),this.options.over&&(html.classList.add(this.classUseOver),this.options.top&&this.pullTop.classList.add(this.classOver),this.options.bottom&&this.pullBottom.classList.add(this.classOver)),this.handlers={touchstart:this.touchstart.bind(this),touchmove:this.touchmove.bind(this),touchend:this.touchend.bind(this),scroll:this.scroll.bind(this)},window.addEventListener('touchstart',this.handlers.touchstart),window.addEventListener('touchmove',this.handlers.touchmove,!!supportsPassive&&eventOptions),window.addEventListener('touchend',this.handlers.touchend),window.addEventListener('resize',this.handlers.scroll),this.container===body||this.container===html?window.addEventListener('scroll',this.handlers.scroll):this.container.addEventListener('scroll',this.handlers.scroll),this.scroll()),this}on(a,b){return Array.isArray(this.callbacks[a])||(this.callbacks[a]=[]),this.callbacks[a].push(b),this}get scrollPos(){let a,b;return this.container===body||this.container===html?(a=window.pageYOffset/(this.container.scrollHeight-window.innerHeight),b=window.innerHeight<this.container.scrollHeight):(a=this.container.scrollTop/(this.container.scrollHeight-this.container.clientHeight),b=this.container.clientHeight<this.container.scrollHeight),!!b&&a}get canPull(){let a=!1,b=this.scrollPos;return 0>=b?a='down':1<=b&&(a='up'),!1===b&&(a='both'),a}resist(a=0){var b=Math.min;let c=b(1,a/this.options.threshold/2.5)*b(this.options.max,a);return a>this.options.max&&(c+=Math.max(0,(a-this.options.max)/6)),c}isMaxWidth(){return this.options.maxWidth&&!isNaN(this.options.maxWidth)&&window.innerWidth>this.options.maxWidth}touchstart(a){this.isMaxWidth()||this.canPull&&(html.classList.remove(this.classPulledUp),html.classList.remove(this.classPulledDown),this.dragging=!0,this.startY=a.touches[0].pageY)}touchmove(a){if(!this.isMaxWidth()&&this.dragging){let b,c=a.touches[0].pageY-this.startY;if(this.direction=this.canPull,this.distance=this.resist(Math.abs(c)),this.abs=this.distance,0>c&&(this.distance=0-this.distance),this.options.top&&('down'===this.direction||'both'===this.direction)&&0<c?(this.direction='down',b=this.pullTop):this.options.bottom&&('up'===this.direction||'both'===this.direction)&&0>c?(this.direction='up',b=this.pullBottom):this.direction=!1,b&&this.direction){if(a.preventDefault(),html.classList.add('down'===this.direction?this.classPullingDown:this.classPullingUp),b.style.height=`${this.abs}px`,this.options.fade&&(b.style.opacity=this.abs/this.options.threshold),this.options.over||(this.container.style.transform=`translateY(${this.distance}px)`),!(this.abs>=this.options.threshold))b.classList.remove(this.classThreshold);else if(b.classList.add(this.classThreshold),!this.executed){if(Array.isArray(this.callbacks.threshold))for(let a of this.callbacks.threshold)/^f/.test(typeof a)&&a.apply(this,[this.direction,this]);this.executed=!0}if(Array.isArray(this.callbacks.pulling))for(let a of this.callbacks.pulling)/^f/.test(typeof a)&&a.apply(this,[this.direction,this.abs,this])}}}touchend(){if(!this.isMaxWidth()&&(this.dragging=!1,this.executed=!1,html.classList.remove(this.classPullingUp),html.classList.remove(this.classPullingDown),this.container.style.transform='',this.options.top&&(this.pullTop.classList.remove(this.classThreshold),this.pullTop.style.height='',this.pullTop.style.opacity=''),this.options.bottom&&(this.pullBottom.classList.remove(this.classThreshold),this.pullBottom.style.height='',this.pullBottom.style.opacity=''),this.abs>=this.options.threshold&&('down'===this.direction&&this.options.top?html.classList.add(this.classPulledDown):'up'===this.direction&&this.options.bottom&&html.classList.add(this.classPulledUp),Array.isArray(this.callbacks.pulled)&&('down'===this.direction&&this.options.top||'up'===this.direction&&this.options.bottom))))for(let a of this.callbacks.pulled)/^f/.test(typeof a)&&a.apply(this,[this.direction,this.abs>=this.options.threshold,this])}scroll(){const a=this.canPull;this.isMaxWidth()||('down'===a?(html.classList.add(this.classIsTop),html.classList.remove(this.classIsBottom)):'up'===a?(html.classList.add(this.classIsBottom),html.classList.remove(this.classIsTop)):(html.classList.remove(this.classIsTop),html.classList.remove(this.classIsBottom)))}destroy(){window.removeEventListener('touchstart',this.handlers.touchstart),window.removeEventListener('touchmove',this.handlers.touchmove,!!supportsPassive&&eventOptions),window.removeEventListener('touchend',this.handlers.touchend),window.removeEventListener('resize',this.handlers.scroll),this.container===body||this.container===html?window.removeEventListener('scroll',this.handlers.scroll):this.container.removeEventListener('scroll',this.handlers.scroll),this.style.parentNode.removeChild(this.style)}}