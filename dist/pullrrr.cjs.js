/*!
 * pullrrr - version 0.4.0
 *
 * Made with ‚ù§ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2020 Steve Ottoz
 */
"use strict";const t=document.body,s=document.documentElement,i=document.head,o={threshold:100,max:150,prefix:"pullrrr",over:!1,fade:!1,maxWidth:!1,top:!0,bottom:!0},e={passive:!1};let n=!1;try{window.addEventListener("test",null,{get passive(){n=!0}})}catch(t){}module.exports=class{constructor(t={}){this.options=Object.assign({},o,t),this.dragging=!1,this.startY=null,this.distance=null,this.abs=null,this.direction=null,this.executed=!1,this.callbacks={},this.classContainer=this.options.prefix+"-container",this.classPullTop=this.options.prefix+"-pull-top",this.classPullBottom=this.options.prefix+"-pull-bottom",this.classUseOver=this.options.prefix+"-use-over",this.classOver=this.options.prefix+"-over",this.classPulledDown=this.options.prefix+"-pulled-down",this.classPulledUp=this.options.prefix+"-pulled-up",this.classPullingDown=this.options.prefix+"-pulling-down",this.classPullingUp=this.options.prefix+"-pulling-up",this.classThreshold=this.options.prefix+"-threshold",this.classIsTop=this.options.prefix+"-is-top",this.classIsBottom=this.options.prefix+"-is-bottom",this.styles=`\n    /**\n    * Required Pullrrr Styles\n    */\n    .${this.options.prefix}-container {\n      transition: 0.2s ease-out;\n    }\n    ${this.options.top?`\n    html.${this.options.prefix}-pulling-down .${this.options.prefix}-container,\n    html.${this.options.prefix}-is-top .${this.options.prefix}-container {\n      touch-action: pan-x pan-down pinch-zoom;\n    }\n    `:""}\n    ${this.options.bottom?`\n    html.${this.options.prefix}-pulling-up .${this.options.prefix}-container,\n    html.${this.options.prefix}-is-bottom .${this.options.prefix}-container {\n      touch-action: pan-x pan-up pinch-zoom;\n    }\n    `:""}\n    html.${this.options.prefix}-pulling-up .${this.options.prefix}-container,\n    html.${this.options.prefix}-pulling-down .${this.options.prefix}-container {\n      transition: 0s;\n    }`,this.init()}init(){return(this.options.top||this.options.bottom)&&(this.style=document.createElement("style"),this.style.id=this.options.prefix+"-styles",this.options.maxWidth&&!isNaN(this.options.maxWidth)?this.style.textContent=`\n        @media (max-width: ${this.options.maxWidth}px) {\n          ${this.styles}\n        }\n        `:this.style.textContent=this.styles,i.appendChild(this.style),this.options.container instanceof Node?this.container=this.options.container:"string"==typeof this.options.container?this.container=document.querySelector(this.options.container):this.container=t,this.container.classList.add(this.classContainer),this.options.top&&(this.options.pullTop instanceof Node?this.pullTop=this.options.pullTop:"string"==typeof this.options.pullTop?this.pullTop=document.querySelector(this.options.pullTop):(this.pullTop=document.querySelector("."+this.classPullTop),this.pullTop||(this.pullTop=document.createElement("div"),this.pullTop.classList.add(this.classPullTop),this.container.appendChild(this.pullTop)))),this.options.bottom&&(this.options.pullBottom instanceof Node?this.pullBottom=this.options.pullBottom:"string"==typeof this.options.pullBottom?this.pullBottom=document.querySelector(this.options.pullBottom):(this.pullBottom=document.querySelector("."+this.classPullBottom),this.pullBottom||(this.pullBottom=document.createElement("div"),this.pullBottom.classList.add(this.classPullBottom),this.container.appendChild(this.pullBottom)))),this.options.over&&(s.classList.add(this.classUseOver),this.options.top&&this.pullTop.classList.add(this.classOver),this.options.bottom&&this.pullBottom.classList.add(this.classOver)),this.handlers={touchstart:this.touchstart.bind(this),touchmove:this.touchmove.bind(this),touchend:this.touchend.bind(this),scroll:this.scroll.bind(this)},window.addEventListener("touchstart",this.handlers.touchstart),window.addEventListener("touchmove",this.handlers.touchmove,!!n&&e),window.addEventListener("touchend",this.handlers.touchend),window.addEventListener("resize",this.handlers.scroll),this.container===t||this.container===s?window.addEventListener("scroll",this.handlers.scroll):this.container.addEventListener("scroll",this.handlers.scroll),this.scroll()),this}on(t,s){return Array.isArray(this.callbacks[t])||(this.callbacks[t]=[]),this.callbacks[t].push(s),this}get scrollPos(){let i,o;return this.container===t||this.container===s?(i=window.pageYOffset/(this.container.scrollHeight-window.innerHeight),o=window.innerHeight<this.container.scrollHeight):(i=this.container.scrollTop/(this.container.scrollHeight-this.container.clientHeight),o=this.container.clientHeight<this.container.scrollHeight),!!o&&i}get canPull(){let t=!1,s=this.scrollPos;return s<=0?t="down":s>=1&&(t="up"),!1===s&&(t="both"),t}resist(t=0){let s=Math.min(1,t/this.options.threshold/2.5)*Math.min(this.options.max,t);return t>this.options.max&&(s+=Math.max(0,(t-this.options.max)/6)),s}isMaxWidth(){return this.options.maxWidth&&!isNaN(this.options.maxWidth)&&window.innerWidth>this.options.maxWidth}touchstart(t){this.isMaxWidth()||this.canPull&&(s.classList.remove(this.classPulledUp),s.classList.remove(this.classPulledDown),this.dragging=!0,this.startY=t.touches[0].pageY)}touchmove(t){if(!this.isMaxWidth()&&this.dragging){let i,o=t.touches[0].pageY-this.startY;if(this.direction=this.canPull,this.distance=this.resist(Math.abs(o)),this.abs=this.distance,o<0&&(this.distance=0-this.distance),this.options.top&&("down"===this.direction||"both"===this.direction)&&o>0?(this.direction="down",i=this.pullTop):this.options.bottom&&("up"===this.direction||"both"===this.direction)&&o<0?(this.direction="up",i=this.pullBottom):this.direction=!1,i&&this.direction){if(t.preventDefault(),s.classList.add("down"===this.direction?this.classPullingDown:this.classPullingUp),i.style.height=this.abs+"px",this.options.fade&&(i.style.opacity=this.abs/this.options.threshold),this.options.over||(this.container.style.transform=`translateY(${this.distance}px)`),this.abs>=this.options.threshold){if(i.classList.add(this.classThreshold),!this.executed){if(Array.isArray(this.callbacks.threshold))for(let t of this.callbacks.threshold)/^f/.test(typeof t)&&t.apply(this,[this.direction,this]);this.executed=!0}}else i.classList.remove(this.classThreshold);if(Array.isArray(this.callbacks.pulling))for(let t of this.callbacks.pulling)/^f/.test(typeof t)&&t.apply(this,[this.direction,this.abs,this])}}}touchend(t){if(!this.isMaxWidth()&&(this.dragging=!1,this.executed=!1,s.classList.remove(this.classPullingUp),s.classList.remove(this.classPullingDown),this.container.style.transform="",this.options.top&&(this.pullTop.classList.remove(this.classThreshold),this.pullTop.style.height="",this.pullTop.style.opacity=""),this.options.bottom&&(this.pullBottom.classList.remove(this.classThreshold),this.pullBottom.style.height="",this.pullBottom.style.opacity=""),this.abs>=this.options.threshold&&("down"===this.direction&&this.options.top?s.classList.add(this.classPulledDown):"up"===this.direction&&this.options.bottom&&s.classList.add(this.classPulledUp),Array.isArray(this.callbacks.pulled)&&("down"===this.direction&&this.options.top||"up"===this.direction&&this.options.bottom))))for(let t of this.callbacks.pulled)/^f/.test(typeof t)&&t.apply(this,[this.direction,this.abs>=this.options.threshold,this])}scroll(t){const i=this.canPull;this.isMaxWidth()||("down"===i?(s.classList.add(this.classIsTop),s.classList.remove(this.classIsBottom)):"up"===i?(s.classList.add(this.classIsBottom),s.classList.remove(this.classIsTop)):(s.classList.remove(this.classIsTop),s.classList.remove(this.classIsBottom)))}destroy(){window.removeEventListener("touchstart",this.handlers.touchstart),window.removeEventListener("touchmove",this.handlers.touchmove,!!n&&e),window.removeEventListener("touchend",this.handlers.touchend),window.removeEventListener("resize",this.handlers.scroll),this.container===t||this.container===s?window.removeEventListener("scroll",this.handlers.scroll):this.container.removeEventListener("scroll",this.handlers.scroll),this.style.parentNode.removeChild(this.style)}};
